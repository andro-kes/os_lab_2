# Лабораторная работа: Медианный фильтр с использованием пула потоков

## Описание

Реализация многопоточного медианного фильтра для обработки изображений/матриц на языке C. Фильтр применяет медианную фильтрацию к матрице целых чисел с использованием скользящего окна заданного размера.

## Особенности

- **Многопоточность**: Использует пул потоков для параллельной обработки строк матрицы
- **Настраиваемые параметры**:
  - Размер окна фильтрации (нечетные числа: 3, 5, 7, ...)
  - Количество применений фильтра (K ≥ 1)
  - Максимальное количество потоков (по умолчанию - количество ядер CPU)
- **Потокобезопасность**: Реализация с мьютексами и условными переменными
- **Кроссплатформенность**: Работает на Linux и Windows (через MSYS/pthread)

## Требования

- Компилятор C с поддержкой C11 (GCC, Clang, MSVC)
- CMake ≥ 3.15
- Библиотека pthreads

## Сборка

```bash
# Создание директории для сборки
mkdir build && cd build

# Конфигурация проекта
cmake ..

# Сборка
cmake --build .

# Включение санитайзеров (опционально)
cmake -DENABLE_SANITIZERS=ON ..
```

## Использование

```bash
./median_filter -m <max_threads> -k <K> -w <window_size> [-i <input_file>] [-o <output_file>]
```

### Параметры командной строки

- `-m max_threads` - максимальное количество потоков (по умолчанию: количество ядер CPU)
- `-k K` - количество применений фильтра (≥1, обязательный параметр)
- `-w window_size` - размер окна (нечетное положительное число, обязательный параметр)
- `-i input_file` - входной файл (по умолчанию: stdin)
- `-o output_file` - выходной файл (по умолчанию: stdout)

### Примеры

```bash
# Обработка с 4 потоками, 2 применения фильтра, окно 3x3
./median_filter -m 4 -k 2 -w 3 -i input.txt -o output.txt

# Чтение из stdin, запись в stdout
./median_filter -k 1 -w 5 < input.txt > output.txt
```

## Формат входных/выходных данных

### Входной формат
```
<rows> <cols>
<element_11> <element_12> ... <element_1c>
<element_21> <element_22> ... <element_2c>
...
<element_r1> <element_r2> ... <element_rc>
```

### Выходной формат
Аналогичен входному формату - матрица тех же размеров после применения фильтра.

## Тестирование

Проект включает базовые тесты через CTest:

```bash
# Запуск тестов
ctest

# Подробный вывод
ctest -V
```

## Структура проекта

```
├── CMakeLists.txt          # Конфигурация сборки
├── src/
│   └── main.c             # Основной исходный код
└── README.md              # Эта документация
```

## Алгоритм

1. Чтение входной матрицы
2. Создание пула потоков и очереди задач
3. Для каждой итерации K:
   - Распределение строк матрицы между потоками
   - Каждый поток обрабатывает свою строку:
     - Для каждого элемента применяет медианную фильтрацию в окрестности window_size × window_size
     - Использует padding по границам матрицы
   - Синхронизация потоков
4. Запись результата

## Примечания

- Программа выводит в stderr информацию о количестве потоков и максимальной наблюдаемой параллельной активности
- Для отладки можно включить санитайзеры Address и UndefinedBehavior при сборке
- Размер окна должен быть нечетным для корректного определения медианы